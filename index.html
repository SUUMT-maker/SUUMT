<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숨트레이너</title> <!-- v1.0.4 -->
    
    <!-- 버전 정보 업데이트 -->
    <meta name="version" content="1.0.6">
    
    <!-- Google Analytics 4 - 숨트레이너 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFYK5NK44V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-TFYK5NK44V');
    </script>
    
    <!-- 🏠 네비게이션 탭 전환 스크립트 -->
    <script>
        // 🏠 네비게이션 탭 전환 함수 (부드러운 페이드 전환)
        function switchTab(tabName) {
            console.log('🔄 탭 전환:', tabName);
            
            // 모든 네비게이션 버튼 비활성화
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 선택된 네비게이션 버튼 활성화
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // 현재 활성화된 화면 찾기
            const currentScreen = document.querySelector('.screen.active');
            
            // 새 화면 결정
            let newScreen = null;
            if (tabName === 'home') {
                newScreen = document.getElementById('mainScreen');
            } else if (tabName === 'workout') {
                newScreen = document.getElementById('workoutModeScreen');
            } else if (tabName === 'records') {
                // 기록 탭은 아직 개발 중
                console.log(`${tabName} 탭은 다음 단계에서 개발 예정`);
                return;
            }
            
            // 새 화면이 없거나 현재 화면과 같으면 리턴
            if (!newScreen || currentScreen === newScreen) return;
            
            // 현재 화면이 있으면 페이드 아웃
            if (currentScreen) {
                currentScreen.classList.add('fade-out');
                currentScreen.addEventListener('transitionend', function handler() {
                    currentScreen.classList.remove('active', 'fade-out');
                    currentScreen.removeEventListener('transitionend', handler);
                });
            }
            
            // 새 화면 페이드 인
            newScreen.classList.add('active');
        }

        // 💪 운동모드 선택 함수 (숨트레이닝 모드 화면으로 전환)
        function selectWorkoutMode(mode) {
            console.log('🎯 운동모드 선택:', mode);
            if (mode === 'breathtraining') {
                // 현재 활성화된 화면 찾기
                const currentScreen = document.querySelector('.screen.active');
                const newScreen = document.getElementById('breathTrainingScreen');
                
                // 새 화면이 없거나 현재 화면과 같으면 리턴
                if (!newScreen || currentScreen === newScreen) return;
                
                // 현재 화면이 있으면 페이드 아웃
                if (currentScreen) {
                    currentScreen.classList.add('fade-out');
                    currentScreen.addEventListener('transitionend', function handler() {
                        currentScreen.classList.remove('active', 'fade-out');
                        currentScreen.removeEventListener('transitionend', handler);
                    });
                }
                
                // 새 화면 페이드 인
                newScreen.classList.add('active');
                
                console.log('숨트레이닝 모드 화면으로 전환됨');
            }
        }
    </script>
    
    <!-- 🌙 다크모드 문제 해결: 색상 스키마 고정 -->
    <meta name="color-scheme" content="light">
    <meta name="supported-color-schemes" content="light">
    
    <!-- 🚀 캐시 방지 및 버전 관리 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- single source of truth for app version -->
    <meta name="version" content="1.0.6">
    
    <!-- PWA 메타 태그 -->
    <meta name="description" content="숨트 호흡운동기구 전용 가이드 앱">
    <meta name="keywords" content="숨트, 호흡운동기구, 호흡근육트레이닝, 폐활량, 호흡근육강화">
    <meta name="author" content="숨트레이너">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="숨트레이너">
    <meta name="application-name" content="숨트레이너">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- 매니페스트 링크 -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- 파비콘 및 아이콘 -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="/icons/icon-180x180.png">
    
    <!-- CSS 파일 -->
    <link rel="stylesheet" href="css/main.css?v=1.0.6">
    <link rel="stylesheet" href="css/components.css?v=1.0.6">
    <link rel="stylesheet" href="css/screens.css?v=1.0.6">
    <link rel="stylesheet" href="css/mobile.css?v=1.0.6">
    
    <!-- Load Supabase SDK (v2.x) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.8/dist/umd/supabase.min.js"></script>
    <script>
        // Initialize Supabase Client once and store as supabaseClient
        if (!window.supabaseClient) {
            const supabaseUrl = 'https://rfqbzibewzvqopqgovbc.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJmcWJ6aWJld3p2cW9wcWdvdmJjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNzIwNTMsImV4cCI6MjA2OTk0ODA1M30.nAXbnAFe4jM7F56QN4b42NhwNJG_iuSXOVM5zC72Bs4';
            window.supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
            console.log('✅ Supabase client initialized:', window.supabaseClient);
        }
    </script>
    
    <!-- JavaScript 파일 -->
    <script src="js/utils.js?v=1.0.6"></script>
    <script src="js/supabase-client.js?v=1.0.6"></script>
    <script src="js/app.js?v=1.0.6"></script>
    <script src="js/stats.js?v=1.0.6"></script>
    <script src="js/exercise.js?v=1.0.6"></script>
    <script src="js/quiz.js?v=1.0.6"></script>
    <script src="js/dashboard.js?v=1.0.6"></script>

</head>
<body>
  <!-- 로그인 화면 -->
  <div id="loginScreen" class="login-container">
    <img src="images/suumt-logo.png" class="app-logo" alt="SUUMT Logo"/>
    <h2>숨트레이너 시작하기</h2>
    <button id="loginKakaoBtn" class="kakao-login-btn">
      <img src="images/suumt-logo.png" class="kakao-icon"/> 카카오로 로그인
    </button>
  </div>

  <!-- 홈 화면 (기존 앱의 첫 화면 컨테이너) -->
  <div id="homeScreen" style="display:none;">
    <!-- 🎬 2단계 온보딩 스플래시 화면 -->
<div id="introScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(135deg, #CFEFFF 0%, #B8E8FF 50%, #A1E1FF 100%); display: flex; justify-content: center; align-items: center; z-index: 2000; opacity: 1; transition: opacity 0.8s ease-out; overflow: hidden;">
    
    <!-- 전체 배경 블러 효과들 -->
    <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at 20% 30%, rgba(46, 181, 250, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 70%, rgba(46, 181, 250, 0.2) 0%, transparent 50%), radial-gradient(circle at 40% 80%, rgba(46, 181, 250, 0.25) 0%, transparent 40%); animation: float 20s ease-in-out infinite;"></div>
    
    <!-- 첫 번째 온보딩 화면 -->
    <div id="onboardingStep1" class="onboarding-step active" style="width: 375px; height: 812px; position: relative; overflow: hidden; display: flex;">
        <!-- 메인 콘텐츠 컨테이너 -->
        <div style="height: 702px; left: 20px; top: 61px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: center; gap: 23px; display: inline-flex;">
            
            <!-- 메인 이미지 -->
            <div style="width: 335px; height: 419px; position: relative; overflow: hidden; border-radius: 12px;">
                <img src="./images/suumt-usage.png" alt="숨트 사용 모습" style="width: 350px; height: 525px; left: -5px; top: -33px; position: absolute; object-fit: cover;" onerror="this.style.display='none';">
            </div>
            
            <!-- 텍스트 및 버튼 영역 -->
            <div style="flex-direction: column; justify-content: flex-start; align-items: center; gap: 40px; display: flex;">
                
                <!-- 텍스트와 인디케이터 -->
                <div style="flex-direction: column; justify-content: flex-start; align-items: center; gap: 32px; display: flex;">
                    
                    <!-- 텍스트 영역 -->
                    <div style="flex-direction: column; justify-content: flex-start; align-items: center; gap: 16px; display: flex;">
                        <div style="width: 320px; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #1E1E1E; font-size: 28px; font-family: 'Space Grotesk', sans-serif; font-weight: 700; line-height: 32px; word-wrap: break-word;">건강한 호흡, 더 나은 삶</div>
                        <div style="width: 280px; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #626262; font-size: 14px; font-family: 'Space Grotesk', sans-serif; font-weight: 400; line-height: 20px; word-wrap: break-word;">AI가 분석하는 개인 맞춤 호흡 강화!<br>당신만의 스마트 호흡 트레이닝 </div>
                    </div>
                    
                    <!-- 페이지 인디케이터 -->
                    <div style="justify-content: flex-start; align-items: flex-start; gap: 4px; display: inline-flex;">
                        <div style="width: 16.97px; height: 4px; background: #1E1E1E; border-radius: 56px;"></div>
                        <div style="width: 4.17px; height: 4px; opacity: 0.30; background: #3D3C3C; border-radius: 56px;"></div>
                    </div>
                    
                </div>
                
                <!-- 버튼 영역 -->
                <div style="justify-content: flex-start; align-items: flex-start; gap: 16px; display: inline-flex;">
                    <button onclick="skipOnboarding()" style="width: 160px; height: 48px; padding: 16px; border-radius: 24px; outline: 1px #2EB5FA solid; outline-offset: -1px; justify-content: center; align-items: center; gap: 10px; display: flex; background: transparent; border: none; cursor: pointer; transition: all 0.3s ease;">
                        <div style="justify-content: center; display: flex; flex-direction: column; color: #2EB5FA; font-size: 16px; font-family: 'Space Grotesk', sans-serif; font-weight: 700; line-height: 16px; word-wrap: break-word;">Skip</div>
                    </button>
                    <button onclick="nextOnboardingStep()" style="width: 159px; height: 48px; padding: 16px; background: #2EB5FA; border-radius: 24px; justify-content: center; align-items: center; gap: 10px; display: flex; border: none; cursor: pointer; transition: all 0.3s ease;">
                        <div style="justify-content: center; display: flex; flex-direction: column; color: white; font-size: 16px; font-family: 'Space Grotesk', sans-serif; font-weight: 700; line-height: 16px; word-wrap: break-word;">Next</div>
                    </button>
                </div>
                
            </div>
            
        </div>
    </div>
    
    <!-- 두 번째 온보딩 화면 -->
    <div id="onboardingStep2" class="onboarding-step" style="width: 375px; height: 812px; position: relative; overflow: hidden; display: none;">
        <!-- 메인 콘텐츠 컨테이너 -->
        <div style="height: 702px; left: 20px; top: 61px; position: absolute; flex-direction: column; justify-content: flex-start; align-items: center; gap: 23px; display: inline-flex;">
            
            <!-- 메인 이미지 -->
            <div style="width: 335px; height: 419px; position: relative; overflow: hidden; border-radius: 12px;">
                <img src="./images/suumt-onboarding.png" alt="숨트 제품" style="width: 350px; height: 419px; left: -5px; top: 0px; position: absolute; object-fit: cover;" onerror="this.style.display='none';">
            </div>
            
            <!-- 텍스트 및 버튼 영역 -->
            <div style="flex-direction: column; justify-content: flex-start; align-items: center; gap: 40px; display: flex;">
                
                <!-- 텍스트와 인디케이터 -->
                <div style="flex-direction: column; justify-content: flex-start; align-items: center; gap: 32px; display: flex;">
                    
                    <!-- 텍스트 영역 -->
                    <div style="flex-direction: column; justify-content: flex-start; align-items: center; gap: 16px; display: flex;">
                        <div style="width: 320px; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #1E1E1E; font-size: 26px; font-family: 'Space Grotesk', sans-serif; font-weight: 700; line-height: 30px; word-wrap: break-word;">숨트와 함께 시작하세요</div>
                        <div style="width: 280px; text-align: center; justify-content: center; display: flex; flex-direction: column; color: #626262; font-size: 14px; font-family: 'Space Grotesk', sans-serif; font-weight: 400; line-height: 20px; word-wrap: break-word;">AI 숨트레이너와 함께<br>나만의 호흡운동을 시작해보세요</div>
                    </div>
                    
                    <!-- 페이지 인디케이터 -->
                    <div style="justify-content: flex-start; align-items: flex-start; gap: 4px; display: inline-flex;">
                        <div style="width: 4.17px; height: 4px; opacity: 0.30; background: #3D3C3C; border-radius: 56px;"></div>
                        <div style="width: 16.97px; height: 4px; background: #1E1E1E; border-radius: 56px;"></div>
                    </div>
                    
                </div>
                
                <!-- 버튼 영역 -->
                <div style="justify-content: flex-start; align-items: flex-start; gap: 16px; display: inline-flex;">
                    <button onclick="skipOnboarding()" style="width: 160px; height: 48px; padding: 16px; border-radius: 24px; outline: 1px #2EB5FA solid; outline-offset: -1px; justify-content: center; align-items: center; gap: 10px; display: flex; background: transparent; border: none; cursor: pointer; transition: all 0.3s ease;">
                        <div style="justify-content: center; display: flex; flex-direction: column; color: #2EB5FA; font-size: 16px; font-family: 'Space Grotesk', sans-serif; font-weight: 700; line-height: 16px; word-wrap: break-word;">Skip</div>
                    </button>
                    <button onclick="skipOnboarding()" style="width: 159px; height: 48px; padding: 16px; background: #2EB5FA; border-radius: 24px; justify-content: center; align-items: center; gap: 10px; display: flex; border: none; cursor: pointer; transition: all 0.3s ease;">
                        <div style="justify-content: center; display: flex; flex-direction: column; color: white; font-size: 16px; font-family: 'Space Grotesk', sans-serif; font-weight: 700; line-height: 16px; word-wrap: break-word;">Start</div>
                    </button>
                </div>
                
            </div>
            
        </div>
    </div>
    
</div>



    <!-- 🎯 커스텀 확인 모달 -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal">
            <h3>트레이닝 중단</h3>
            <p>정말 숨트레이닝을 중단하시겠습니까?</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="hideModal()">취소</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmStop()">중단</button>
            </div>
        </div>
    </div>

    <!-- 🎮 배지 획득 팝업 -->
    <div id="badgePopup" class="badge-popup-overlay">
        <div class="badge-popup">
            <div class="badge-popup-icon" id="badgePopupIcon">🏆</div>
            <h3>배지 획득!</h3>
            <div class="badge-name" id="badgePopupName">첫 걸음</div>
            <p id="badgePopupDescription">첫 번째 호흡 트레이닝을 완료하셨습니다!</p>
            <button class="badge-popup-close" onclick="closeBadgePopup()">확인</button>
        </div>
    </div>

    <div class="app-container">
        <!-- 메인 화면 -->
        <div id="mainScreen" class="screen active">
            <!-- 메인 헤더 -->
            <div class="main-header">
                <div class="user-greeting">
                    <div class="user-info">
                        <div class="user-avatar">
                            <img src="./images/suumt-logo.png" alt="숨트 로고" onerror="this.style.display='none'; this.parentNode.innerHTML='🫁';">
                        </div>
                        <div class="user-text">
                            <h4>안녕하세요,</h4>
                            <h3 id="userName">AI 숨트레이너</h3>
                            <!-- 🔥 새로운 기능: 메인화면 실시간 현황 -->
                            <div class="live-users-badge" id="mainLiveUsers">
                                <div class="live-indicator"></div>
                                <span id="mainLiveUsersText">오늘 247명 트레이닝 중</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 통계 섹션 -->
            <div class="stats-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">
                            <span class="section-icon">📊</span>
                            <span>오늘의 기록</span>
                        </h2>
                        <div class="section-subtitle">오늘 하루 나의 호흡 트레이닝 현황</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">오늘 호흡</div>
                            <div class="stat-card-icon">🫁</div>
                        </div>
                        <div class="stat-card-value">
                            <div class="stat-number" id="totalBreaths">0</div>
                            <div class="stat-unit">회</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">오늘 완료</div>
                            <div class="stat-card-icon">💪</div>
                        </div>
                        <div class="stat-card-value">
                            <div class="stat-number" id="averageSets">0</div>
                            <div class="stat-unit">세트</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">연속 일수</div>
                            <div class="stat-card-icon">🔥</div>
                        </div>
                        <div class="stat-card-value">
                            <div class="stat-number" id="consecutiveDays">0</div>
                            <div class="stat-unit">일</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-title">총 트레이닝</div>
                            <div class="stat-card-icon">🏆</div>
                        </div>
                        <div class="stat-card-value">
                            <div class="stat-number" id="totalExercises">0</div>
                            <div class="stat-unit">회</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 차트 섹션 -->
            <div class="chart-section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">
                            <span class="section-icon">📈</span>
                            <span>주간 활동</span>
                        </h2>
                        <div class="section-subtitle" id="chartSubtitle">이번 주 트레이닝 성과를 한눈에</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-legend">완료한 세트 수 (일별)</div>
                    <div class="chart-area">
                        <div class="chart-y-axis">
                            <div class="y-label">4</div>
                            <div class="y-label">3</div>
                            <div class="y-label">2</div>
                            <div class="y-label">1</div>
                            <div class="y-label">0</div>
                        </div>
                        <div class="chart-bars" id="chartBars">
                            <div class="chart-bar" style="height: 0%" data-day="0"></div>
                            <div class="chart-bar" style="height: 0%" data-day="1"></div>
                            <div class="chart-bar" style="height: 0%" data-day="2"></div>
                            <div class="chart-bar" style="height: 0%" data-day="3"></div>
                            <div class="chart-bar" style="height: 0%" data-day="4"></div>
                            <div class="chart-bar" style="height: 0%" data-day="5"></div>
                            <div class="chart-bar" style="height: 0%" data-day="6"></div>
                        </div>
                    </div>
                    <div class="chart-x-axis" id="chartXAxis">
                        <div class="x-label">일</div>
                        <div class="x-label">월</div>
                        <div class="x-label">화</div>
                        <div class="x-label">수</div>
                        <div class="x-label">목</div>
                        <div class="x-label">금</div>
                        <div class="x-label">토</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 운동 화면 -->
        <div id="exerciseScreen" class="screen">
            <div class="container">
                <div id="countdownSection">
                    <h2>트레이닝을 시작할게요</h2>
                    <div class="countdown" id="countdown">3</div>
                </div>

                <div id="breathingSection" style="display: none;">
                    <div class="breathing-circle" id="breathingCircle">
                        <span id="circleText">준비</span>
                    </div>
                    
                    <div class="progress-container">
                        <div class="sets-progress">
                            <div class="progress-label">세트 진행도</div>
                            <div class="sets-indicators" id="setsIndicators">
                                <div class="set-indicator"></div>
                                <div class="set-indicator"></div>
                            </div>
                            <div class="progress-numbers" id="setNumbers">1 / 2 세트</div>
                        </div>
                        
                        <div class="breaths-progress">
                            <div class="progress-label">호흡 횟수</div>
                            <div class="breaths-indicators" id="breathsIndicators">
                                <!-- 10개의 호흡 점들이 JavaScript로 생성됨 -->
                            </div>
                            <div class="progress-numbers" id="breathNumbers">1 / 10 회</div>
                        </div>
                    </div>
                    
                    <div class="control-buttons">
                        <button class="btn btn-secondary" onclick="pauseExercise()">일시정지</button>
                        <button class="btn btn-secondary" onclick="showStopModal()">중단</button>
                    </div>
                </div>

                <div id="restSection" style="display: none;">
                    <h2>휴식 시간</h2>
                    <div class="countdown" id="restCountdown">2:00</div>
                    <p>다음 세트까지 호흡을 정리하세요</p>
                    <div class="progress-numbers" id="restProgressText">1세트 완료</div>
                    
                    <div class="control-buttons" id="restControlButtons" style="display: none;">
                        <button class="btn btn-success" onclick="skipRest()">휴식 건너뛰기</button>
                        <button class="btn btn-secondary" onclick="showStopModal()">중단</button>
                    </div>
                </div>

                <!-- 🎮 퀴즈 제안 화면 -->
                <div id="quizOfferSection" style="display: none;">
                    <h2>휴식 시간</h2>
                    <div class="countdown" id="quizOfferCountdown">2:00</div>
                    
                    <div class="quiz-offer-card">
                        <div class="quiz-offer-title">간단한 퀴즈 풀까요?</div>
                        <div class="quiz-offer-subtitle" id="quizOfferSubtitle">2문제만! 특별 혜택도 받으세요</div>
                        
                        <div class="quiz-offer-buttons">
                            <button class="quiz-offer-primary" onclick="startQuiz()" id="quizOfferButton">
                                퀴즈 풀고 15% 할인받기
                            </button>
                            <button class="quiz-offer-secondary" onclick="chooseRestOnly()">
                                휴식만 하기
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 🧠 퀴즈 진행 화면 -->
                <div id="quizProgressSection" style="display: none;">
                    <div class="quiz-progress-header">
                        <h2>퀴즈 타임!</h2>
                        <div class="countdown" id="quizCountdown">2:00</div>
                        
                        <div class="quiz-progress-bar">
                            <div class="quiz-progress-fill" id="quizProgressFill" style="width: 50%"></div>
                        </div>
                        <div class="quiz-progress-text" id="quizProgressText">문제 1 / 2</div>
                    </div>
                    
                    <div class="quiz-question-card">
                        <div class="quiz-question" id="quizQuestion">문제가 여기에 표시됩니다</div>
                        <div class="quiz-options" id="quizOptions">
                            <!-- 선택지들이 JavaScript로 생성됨 -->
                        </div>
                        <div class="quiz-explanation" id="quizExplanation" style="display: none;">
                            설명이 여기에 표시됩니다
                        </div>
                    </div>
                </div>

                <!-- 🎁 퀴즈 보상 화면 -->
                <div id="quizRewardSection" style="display: none;">
                    <h2>휴식 시간</h2>
                    <div class="countdown" id="quizRewardCountdown">2:00</div>
                    
                    <div class="quiz-reward-card">
                        <div class="quiz-reward-title">🎉 퀴즈 완료!</div>
                        <div class="quiz-reward-subtitle" id="quizRewardSubtitle">2문제 모두 정답! 특별 혜택을 받으세요</div>
                        
                        <div class="quiz-product-showcase">
                            <div class="quiz-product-image">
                                <img src="./images/suumt-product.png" alt="숨트 제품" id="rewardProductImage" 
                                     onerror="this.style.display='none'; this.parentNode.innerHTML='🎁';">
                            </div>
                            <div class="quiz-product-name" id="rewardProductName">숨트 호흡운동기구</div>
                            <div class="quiz-product-description" id="rewardProductDescription">앱 사용자만을 위한 특별가</div>
                            <div class="quiz-product-price-line">
                                <span class="quiz-original-price" id="rewardOriginalPrice">89,000원</span>
                                <span class="quiz-price-arrow">→</span>
                                <span class="quiz-discount-price" id="rewardDiscountPrice">75,650원</span>
                                <span class="quiz-discount-badge" id="rewardDiscountBadge">15%↓</span>
                            </div>
                        </div>
                        
                        <div class="quiz-dual-buttons">
                            <button class="quiz-check-button" onclick="checkSpecialOffer()">
                                👀 특가 확인하기
                            </button>
                            <button class="quiz-continue-button" onclick="continueToNextSet()">
                                💪 다음 세트 시작
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 피드백 페이지 -->
        <div id="feedbackScreen" class="screen">
            <div class="container">
                <div class="celebration">🤖</div>
                <h2 id="feedbackTitle">지금 호흡하는 느낌이 어떠세요?</h2>
                <p class="subtitle" id="feedbackDescription">방금 완료한 트레이닝의 강도는 어떠셨나요?</p>
                
                <div class="feedback-options">
                    <button class="feedback-option easy" onclick="selectFeedback('easy')">
                        <div class="feedback-emoji">😌</div>
                        <div class="feedback-text">너무 편해요</div>
                        <div class="feedback-desc">더 강한 강도로 도전할 수 있어요</div>
                    </button>
                    
                    <button class="feedback-option perfect" onclick="selectFeedback('perfect')">
                        <div class="feedback-emoji">💪</div>
                        <div class="feedback-text">딱 좋아요</div>
                        <div class="feedback-desc">적당히 힘들면서 완주할 수 있었어요</div>
                    </button>
                    
                    <button class="feedback-option hard" onclick="selectFeedback('hard')">
                        <div class="feedback-emoji">😤</div>
                        <div class="feedback-text">너무 힘들어요</div>
                        <div class="feedback-desc">강도를 낮춰서 안전하게 운동하고 싶어요</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- 결과 화면 -->
        <div id="resultScreen" class="screen">
            <div class="container">
                <div class="result-header">
                    <div class="celebration">🎉</div>
                    <h2>트레이닝 완료!</h2>
                </div>
                
                <div class="result-stats-grid">
                    <div class="result-stat-card">
                        <div class="result-stat-header">
                            <span class="result-stat-title">저항 강도</span>
                            <span class="result-stat-icon">🎯</span>
                        </div>
                        <div class="result-stat-value" id="resistanceInfo">1/1</div>
                    </div>
                    
                    <div class="result-stat-card">
                        <div class="result-stat-header">
                            <span class="result-stat-title">총 시간</span>
                            <span class="result-stat-icon">⏱️</span>
                        </div>
                        <div class="result-stat-value" id="totalTime">0분</div>
                    </div>
                    
                    <div class="result-stat-card">
                        <div class="result-stat-header">
                            <span class="result-stat-title">완료 세트</span>
                            <span class="result-stat-icon">✅</span>
                        </div>
                        <div class="result-stat-value" id="completedSets">0/2</div>
                    </div>
                    
                    <div class="result-stat-card">
                        <div class="result-stat-header">
                            <span class="result-stat-title">총 호흡횟수</span>
                            <span class="result-stat-icon">🫁</span>
                        </div>
                        <div class="result-stat-value" id="totalBreathsResult">0회</div>
                    </div>
                </div>

                <!-- 🎮 배지 시스템 -->
                <div class="badges-system">
                    <div class="badges-header">
                        <span class="section-icon">🏆</span>
                        <span class="badges-title">배지 컬렉션</span>
                    </div>
                    <div class="badges-progress" id="badgesProgress">수집한 배지: 0/15</div>
                    <div class="badges-grid" id="badgesGrid">
                        <!-- 배지들이 JavaScript로 생성됨 -->
                    </div>
                </div>

                <!-- 🔥 새로운 기능: 사회적 증명 섹션 -->
                <div class="social-proof-section">
                    <div class="social-proof-card">
                        <div class="social-proof-header">
                            <span class="section-icon">👥</span>
                            <span class="social-proof-title">함께하는 숨트 커뮤니티</span>
                        </div>
                        
                        <div class="live-stats">
                            <div class="live-stat">
                                <div class="live-stat-number" id="liveUsersCount">1,247</div>
                                <div class="live-stat-label">오늘 활동 중</div>
                            </div>
                            <div class="live-stat">
                                <div class="live-stat-number" id="totalUsersCount">12,543</div>
                                <div class="live-stat-label">전체 사용자</div>
                            </div>
                        </div>
                        
                        <div class="reviews-carousel">
                            <div class="reviews-slider" id="reviewsSlider">
                                <!-- 리뷰 카드들이 JavaScript로 생성됨 -->
                            </div>
                            <div class="carousel-dots" id="carouselDots">
                                <!-- 점들이 JavaScript로 생성됨 -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="achievementBadges"></div>

                <div class="result-content">
                    <div class="result-section">
                        <h4>💪 저항 강도 분석</h4>
                        <p id="intensityAdvice">강도 조절 분석을 진행하고 있습니다...</p>
                    </div>

                    <div class="result-section">
                        <h4>🏆 AI 숨트레이너 종합평가</h4>
                        <p id="comprehensiveAdvice">AI 숨트레이너가 당신의 트레이닝을 분석하고 있습니다...</p>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="btn btn-success" onclick="startExercise()">다시 트레이닝하기</button>
                    <button class="btn" onclick="goToMain()">메인으로</button>
                </div>
            </div>
        </div>

        <!-- 💪 운동모드 선택 화면 -->
        <div id="workoutModeScreen" class="screen">
            <div class="workout-mode-header">
                <h2>💪 운동모드 선택</h2>
                <p>오늘은 어떤 호흡 운동을 하시겠어요?</p>
            </div>
            
            <div class="workout-modes-container">
                <!-- 웜업 모드 (비활성화) -->
                <div class="workout-mode-card disabled">
                    <div class="mode-illustration">
                        <div class="mode-avatar">
                            <div class="avatar-bg warmup"></div>
                            <div class="avatar-icon">🌅</div>
                        </div>
                    </div>
                    <div class="mode-content">
                        <h3>웜업</h3>
                        <p>가벼운 호흡으로 몸을 깨우고 하루를 준비하세요.</p>
                        <div class="mode-pattern">2 - 2 - 2 호흡</div>
                    </div>
                    <div class="mode-status">곧 출시</div>
                </div>
                
                <!-- 숨트레이닝 모드 (활성화) -->
                <div class="workout-mode-card active" onclick="selectWorkoutMode('breathtraining')">
                    <div class="mode-illustration">
                        <div class="mode-avatar">
                            <div class="avatar-bg breathtraining"></div>
                            <div class="avatar-icon">🫁</div>
                        </div>
                    </div>
                    <div class="mode-content">
                        <h3>숨트레이닝</h3>
                        <p>호흡근육을 강화하고 폐활량을 늘려보세요.</p>
                        <div class="mode-pattern">4 - 4 - 4 호흡</div>
                    </div>
                    <div class="mode-status">선택 가능</div>
                </div>
                
                <!-- 잠들기전 모드 (비활성화) -->
                <div class="workout-mode-card disabled">
                    <div class="mode-illustration">
                        <div class="mode-avatar">
                            <div class="avatar-bg sleep"></div>
                            <div class="avatar-icon">🌙</div>
                        </div>
                    </div>
                    <div class="mode-content">
                        <h3>잠들기전</h3>
                        <p>긴장을 풀고 편안한 수면을 위한 호흡법입니다.</p>
                        <div class="mode-pattern">4 - 7 - 8 호흡</div>
                    </div>
                    <div class="mode-status">곧 출시</div>
                </div>
            </div>
        </div>

        <!-- 🫁 숨트레이닝 모드 화면 -->
        <div id="breathTrainingScreen" class="screen">
            <div class="section-header">
                <h2 class="section-title"><span class="section-icon">🫁</span> 숨트레이닝 모드</h2>
                <p class="section-subtitle">호흡 가이드, 저항 설정, 트레이닝 시작</p>
            </div>
            
            <!-- 가이드 카드 -->
            <div class="guide-card">
                <div class="guide-header">
                    <div class="guide-title">📋 숨트 트레이닝 가이드</div>
                </div>
                
                <div class="important-notice">
                    <span class="important-icon">💡</span>
                    <span class="important-text">호흡할 때는 의식적으로 힘을 주어 깊게 호흡하세요!</span>
                </div>
                
                <div class="guide-step">숨트 기구의 다이얼을 돌려 저항 강도를 설정해주세요</div>
                <div class="guide-step">설정한 저항 강도를 아래 화면에 똑같이 입력하세요</div>
                <div class="guide-step">복식호흡으로 코가 아닌 입으로만 호흡하세요</div>
            </div>

            <!-- 저항 설정 -->
            <div class="resistance-card">
                <div class="resistance-header">
                    <div class="resistance-title">🎯 저항 강도 설정</div>
                </div>
                
                <div class="resistance-controls">
                    <div class="resistance-control">
                        <div class="resistance-label">들숨 (Inhale)</div>
                        <div class="resistance-selector">
                            <button class="resistance-btn" onclick="adjustResistance('inhale', -1)">−</button>
                            <div class="resistance-value" id="inhaleLevel">1</div>
                            <button class="resistance-btn" onclick="adjustResistance('inhale', 1)">+</button>
                        </div>
                        <div class="resistance-dots" id="inhaleScale">
                            <div class="dot active"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                    </div>

                    <div class="resistance-control">
                        <div class="resistance-label">날숨 (Exhale)</div>
                        <div class="resistance-selector">
                            <button class="resistance-btn" onclick="adjustResistance('exhale', -1)">−</button>
                            <div class="resistance-value" id="exhaleLevel">1</div>
                            <button class="resistance-btn" onclick="adjustResistance('exhale', 1)">+</button>
                        </div>
                        <div class="resistance-dots" id="exhaleScale">
                            <div class="dot active"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                    </div>
                </div>

                <div class="resistance-tip">
                    💡 처음이시면 1단계 추천 • 적당히 힘든 강도가 최적이에요!
                </div>
            </div>

            <!-- 트레이닝 시작 -->
            <div class="start-training-section">
                <button class="start-button" onclick="startExercise()">
                    <span>🚀</span>
                    <span>트레이닝 시작</span>
                </button>
            </div>
        </div>

        <!-- 📒 운동 기록 화면 -->
        <div id="recordsScreen" class="screen">
            <div class="section-header">
                <h2 class="section-title"><span class="section-icon">📒</span> 운동 기록</h2>
                <p class="section-subtitle">운동한 날과 AI 조언 요약을 확인하세요</p>
            </div>

            <!-- Calendar -->
            <div class="records-calendar card">
                <div class="calendar-header">
                    <button class="calendar-nav-btn" id="prevMonthBtn">‹</button>
                    <h3 class="calendar-title" id="calendarTitle">2025년 1월</h3>
                    <button class="calendar-nav-btn" id="nextMonthBtn">›</button>
                </div>
                <table class="calendar-table">
                    <thead>
                        <tr>
                            <th>일</th>
                            <th>월</th>
                            <th>화</th>
                            <th>수</th>
                            <th>목</th>
                            <th>금</th>
                            <th>토</th>
                        </tr>
                    </thead>
                    <tbody id="calendarBody">
                        <!-- 달력 날짜들이 JavaScript로 동적 생성됨 -->
                    </tbody>
                </table>
                <div class="calendar-loading" id="calendarLoading" style="display: none;">
                    📊 운동 기록을 불러오는 중...
                </div>
            </div>

            <!-- Selected Day Summary -->
            <div class="records-summary card">
                <h3>선택한 날짜: <span id="selectedDate">-</span></h3>
                <ul id="recordSummaryList">
                    <li>운동 세트 수: -</li>
                    <li>총 운동 시간: -</li>
                    <li>평균 저항 강도: -</li>
                </ul>
            </div>

            <!-- AI Advice Summary -->
            <div class="records-ai-advice card">
                <div class="ai-advice-header">
                    <div class="ai-advice-title">
                        <span class="ai-advice-icon">🤖</span>
                        <h3>AI 숨트레이너 조언</h3>
                    </div>
                    <div class="ai-advice-badge" id="aiAdviceBadge" style="display: none;">
                        새로운 조언
                    </div>
                </div>
                <div class="ai-advice-content">
                    <div class="ai-advice-loading" id="aiAdviceLoading" style="display: none;">
                        <div class="loading-spinner"></div>
                        <span>AI가 조언을 분석하는 중...</span>
                    </div>
                    <div class="ai-advice-text" id="aiAdviceSummary">
                        날짜를 선택하면 AI 숨트레이너의 개인화된 조언을 확인할 수 있습니다.
                    </div>
                    <div class="ai-advice-empty" id="aiAdviceEmpty" style="display: none;">
                        <div class="empty-state-icon">💭</div>
                        <p>선택한 날짜에 AI 조언이 없습니다.</p>
                        <small>운동 완료 후 AI가 분석한 조언을 여기서 확인하세요.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <!-- 🚀 하단 네비게이션 바 -->
    <nav id="bottomNavigation" class="bottom-nav">
        <button class="nav-btn active" data-tab="home" onclick="switchTab('home')">
            <div class="nav-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
            </div>
            <div class="nav-label">홈</div>
        </button>
        
        <button class="nav-btn" data-tab="workout" onclick="switchTab('workout')">
            <div class="nav-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20m8-18H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/>
                    <path d="M8 6v4m8-4v4"/>
                </svg>
            </div>
            <div class="nav-label">운동모드</div>
        </button>
        
        <button class="nav-btn" data-tab="records" onclick="switchTab('records')">
            <div class="nav-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
            </div>
            <div class="nav-label">기록</div>
        </button>
    </nav>

    <style>
    /* 🚀 하단 네비게이션 바 스타일 */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 70px;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(0, 0, 0, 0.08);
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 1000;
        padding: 0 20px;
        box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.06);
    }

    .nav-btn {
        background: none;
        border: none;
        padding: 8px 16px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 60px;
        color: #6b7280;
    }

    .nav-btn:hover {
        background: rgba(102, 126, 234, 0.08);
        transform: translateY(-2px);
    }

    .nav-btn.active {
        background: rgba(102, 126, 234, 0.12);
        color: #667eea;
    }

    .nav-btn.active .nav-icon {
        transform: scale(1.05);
    }

    .nav-icon {
        margin-bottom: 4px;
        transition: transform 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .nav-icon svg {
        transition: all 0.3s ease;
    }

    .nav-btn.active .nav-icon svg {
        stroke: #667eea;
        stroke-width: 2.5;
    }

    .nav-label {
        font-size: 10px;
        font-weight: 500;
        opacity: 0.7;
        transition: all 0.3s ease;
    }

    .nav-btn.active .nav-label {
        opacity: 1;
        font-weight: 600;
        color: #667eea;
    }

    /* 메인 콘텐츠 하단 여백 확보 (네비게이션 공간) */
    .screen {
        padding-bottom: 80px;
        display: none;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .screen.active {
        display: block;
        opacity: 1;
    }
    
    .screen.fade-out {
        opacity: 0;
    }

    /* 모바일 최적화 */
    @media (max-width: 480px) {
        .bottom-nav {
            height: 65px;
            padding: 0 15px;
        }
        
        .nav-btn {
            padding: 6px 12px;
            min-width: 50px;
        }
        
        .nav-label {
            font-size: 9px;
        }
        
        .screen {
            padding-bottom: 75px;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .screen.active {
            display: block;
            opacity: 1;
        }
        
        .screen.fade-out {
            opacity: 0;
        }
    }

    /* 💪 운동모드 선택 화면 스타일 */
    .workout-mode-header {
        text-align: center;
        padding: 20px;
        margin-bottom: 20px;
    }

    .workout-mode-header h2 {
        font-size: 24px;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 8px;
    }

    .workout-mode-header p {
        font-size: 16px;
        color: #6b7280;
        margin: 0;
    }

    .workout-modes-container {
        padding: 0 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .workout-mode-card {
        background: white;
        border-radius: 16px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 16px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        border: 2px solid transparent;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
    }

    .workout-mode-card.active {
        border-color: #667eea;
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
        transform: translateY(-2px);
    }

    .workout-mode-card.active:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 25px rgba(102, 126, 234, 0.2);
    }

    .workout-mode-card.disabled {
        opacity: 0.6;
        cursor: not-allowed;
        background: #f9fafb;
    }

    .mode-illustration {
        flex-shrink: 0;
    }

    .mode-avatar {
        width: 60px;
        height: 60px;
        position: relative;
        border-radius: 50%;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .avatar-bg {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 50%;
    }

    .avatar-bg.warmup {
        background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
    }

    .avatar-bg.breathtraining {
        background: linear-gradient(135deg, #ddd6fe 0%, #8b5cf6 100%);
    }

    .avatar-bg.sleep {
        background: linear-gradient(135deg, #e0e7ff 0%, #6366f1 100%);
    }

    .avatar-icon {
        font-size: 24px;
        position: relative;
        z-index: 1;
    }

    .mode-content {
        flex-grow: 1;
    }

    .mode-content h3 {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin: 0 0 4px 0;
    }

    .mode-content p {
        font-size: 14px;
        color: #6b7280;
        margin: 0 0 8px 0;
        line-height: 1.4;
    }

    .mode-pattern {
        font-size: 12px;
        font-weight: 600;
        color: #667eea;
        background: rgba(102, 126, 234, 0.1);
        padding: 4px 8px;
        border-radius: 6px;
        display: inline-block;
    }

    .mode-status {
        position: absolute;
        top: 12px;
        right: 12px;
        font-size: 10px;
        font-weight: 600;
        padding: 4px 8px;
        border-radius: 8px;
        text-transform: uppercase;
    }

    .workout-mode-card.active .mode-status {
        background: #667eea;
        color: white;
    }

    .workout-mode-card.disabled .mode-status {
        background: #e5e7eb;
        color: #9ca3af;
    }

    /* 모바일 최적화 - 운동모드 화면 */
    @media (max-width: 480px) {
        .workout-mode-card {
            padding: 16px;
            gap: 12px;
        }
        
        .mode-avatar {
            width: 50px;
            height: 50px;
        }
        
        .avatar-icon {
            font-size: 20px;
        }
        
        .mode-content h3 {
            font-size: 16px;
        }
        
        .mode-content p {
            font-size: 13px;
        }
    }

    /* 상단 안전 여백 처리 */
    #breathTrainingScreen .section-header {
        margin-top: max(24px, env(safe-area-inset-top));
        /* 모바일 notch 고려 */
    }
    </style>

</body>
</html>
